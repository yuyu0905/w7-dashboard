import{S as h}from"./sweetalert2.all-5934950a.js";import{M as $,P as L,D as P}from"./DelModal-6c93af69.js";import{_ as O,r as u,o as l,c as d,a as _,b as e,t as o,h as x,F as m,j as g,d as y,k as M,n as V}from"./index-78da3a39.js";const D={props:["tempOrder"],emits:["updatePaid"],data(){return{isLoading:!1,orderModal:""}},methods:{showModal(){this.orderModal.show()},hideModal(){this.orderModal.hide()}},mounted(){this.orderModal=new $(this.$refs.orderModal,{keyboard:!1})},computed:{innerOrder(){return this.tempOrder}}},E={id:"orderModal",ref:"orderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},I={class:"modal-dialog modal-xl"},B={class:"modal-content border-0"},A=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{id:"orderModalLabel",class:"modal-title"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),N={class:"modal-body"},T={class:"row"},U={class:"col-md-4"},F=e("h3",null,"用戶資料",-1),S={class:"table"},j={key:0},q=e("th",{style:{width:"100px"}},"姓名",-1),H=e("th",null,"Email",-1),R=e("th",null,"電話",-1),z=e("th",null,"地址",-1),G={class:"col-md-8"},J=e("h3",null,"訂單細節",-1),K={class:"table"},Q=e("th",{style:{width:"100px"}},"訂單編號",-1),W=e("th",null,"下單時間",-1),X=e("th",null,"付款狀態",-1),Y={key:0,class:"text-success"},Z={key:1,class:"text-muted"},ee=e("th",null,"總金額",-1),te=e("h3",null,"選購商品",-1),se={class:"table"},ne=e("thead",null,[e("tr")],-1),oe={class:"text-end"},le={class:"d-flex justify-content-end"},de={class:"form-check"},ae={class:"form-check-label",for:"flexCheckDefault"},ie={key:0},re={key:1},ce={class:"modal-footer"},he=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ue(s,n,v,k,c,t){const p=u("VueLoading");return l(),d(m,null,[_(p,{active:c.isLoading},null,8,["active"]),e("div",E,[e("div",I,[e("div",B,[A,e("div",N,[e("div",T,[e("div",U,[F,e("table",S,[t.innerOrder.user?(l(),d("tbody",j,[e("tr",null,[q,e("td",null,o(t.innerOrder.user.name),1)]),e("tr",null,[H,e("td",null,o(t.innerOrder.user.email),1)]),e("tr",null,[R,e("td",null,o(t.innerOrder.user.tel),1)]),e("tr",null,[z,e("td",null,o(t.innerOrder.user.address),1)])])):x("",!0)])]),e("div",G,[J,e("table",K,[e("tbody",null,[e("tr",null,[Q,e("td",null,o(t.innerOrder.id),1)]),e("tr",null,[W,e("td",null,o(s.$dateFormat.date(t.innerOrder.create_at)),1)]),e("tr",null,[X,e("td",null,[t.innerOrder.is_paid?(l(),d("strong",Y,"已付款")):(l(),d("span",Z,"尚未付款"))])]),e("tr",null,[ee,e("td",null,o(t.innerOrder.total),1)])])]),te,e("table",se,[ne,e("tbody",null,[(l(!0),d(m,null,g(t.innerOrder.products,i=>(l(),d("tr",{key:i.id},[e("th",null,o(i.product.title),1),e("td",null,o(i.qty)+" / "+o(i.product.unit),1),e("td",oe,o(i.final_total),1)]))),128))])]),e("div",le,[e("div",de,[y(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":n[0]||(n[0]=i=>t.innerOrder.is_paid=i)},null,512),[[M,t.innerOrder.is_paid]]),e("label",ae,[t.innerOrder.is_paid?(l(),d("span",ie,"已付款")):(l(),d("span",re,"未付款"))])])])])])]),e("div",ce,[he,e("button",{type:"button",class:"btn btn-primary",onClick:n[1]||(n[1]=i=>s.$emit("updatePaid",t.innerOrder))}," 修改付費狀態 ")])])])],512)],64)}const _e=O(D,[["render",ue]]),{VITE_API:f,VITE_APIPATH:b}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"vue-hexschool-product-list",BASE_URL:"/w7-dashboard/",MODE:"production",DEV:!1,PROD:!0},me={data(){return{isLoading:!1,orders:[],operateType:"",tempOrder:{},pagination:{},pageNum:1}},methods:{getOrders(s=1){this.isLoading=!0,this.pageNum=s,this.$http.get(`${f}/api/${b}/admin/orders?page=${s}`).then(n=>{this.orders=n.data.orders,this.pagination=n.data.pagination,this.isLoading=!1}).catch(n=>{h.fire({icon:"error",title:n.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},updatePaid(s){this.isLoading=!0,this.$http.put(`${f}/api/${b}/admin/order/${s.id}`,{data:{is_paid:s.is_paid}}).then(n=>{this.$refs.orderModal.hideModal(),h.fire({icon:"success",title:n.data.message,showConfirmButton:!1,timer:1500}),this.getOrders(this.pageNum),this.isLoading=!1}).catch(n=>{h.fire({icon:"error",title:n.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},deleteOrder(){this.isLoading=!0,this.$http.delete(`${f}/api/${b}/admin/order/${this.tempOrder.id}`,{data:this.tempOrder}).then(s=>{this.$refs.delModal.hideModal(),h.fire({icon:"success",title:s.data.message,showConfirmButton:!1,timer:1500}),this.getOrders(this.pageNum),this.isLoading=!1}).catch(s=>{h.fire({icon:"error",title:s.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},openModal(s,n){this.operateType=s,s==="view"?(this.tempOrder={...n},this.$refs.orderModal.showModal()):s==="delete"&&(this.tempOrder={...n},this.$refs.delModal.showModal())}},components:{PaginationComponent:L,OrderModal:_e,DelModal:P},mounted(){this.getOrders()}},pe={class:"container"},fe={class:"mt-4"},be={class:"table align-middle"},ge=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"Email"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),Oe={class:"list-unstyled"},ye={class:"text-end"},Me={class:"form-check form-switch"},ve=["id","onUpdate:modelValue","onChange"],ke=["for"],Ce={key:0},we={key:1},$e={class:"btn-group"},Le=["onClick"],Pe=["onClick"];function xe(s,n,v,k,c,t){const p=u("VueLoading"),i=u("PaginationComponent"),C=u("OrderModal"),w=u("DelModal");return l(),d(m,null,[_(p,{active:c.isLoading},null,8,["active"]),e("div",pe,[e("div",fe,[e("table",be,[ge,e("tbody",null,[(l(!0),d(m,null,g(c.orders,a=>(l(),d("tr",{key:a.id,class:V({"text-secondary":!a.is_paid})},[e("td",null,o(s.$dateFormat.date(a.create_at)),1),e("td",null,o(a.user.email),1),e("td",null,[e("ul",Oe,[(l(!0),d(m,null,g(a.products,r=>(l(),d("li",{key:r.id},o(r.product.title)+" 數量："+o(r.qty)+" "+o(r.product.unit),1))),128))])]),e("td",ye,o(a.total),1),e("td",null,[e("div",Me,[y(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:a.id,"onUpdate:modelValue":r=>a.is_paid=r,onChange:r=>t.updatePaid(a)},null,40,ve),[[M,a.is_paid]]),e("label",{class:"form-check-label",for:a.id},[a.is_paid?(l(),d("span",Ce,"已付款")):(l(),d("span",we,"未付款"))],8,ke)])]),e("td",null,[e("div",$e,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:r=>t.openModal("view",a)}," 檢視 ",8,Le),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>t.openModal("delete",a)}," 刪除 ",8,Pe)])])],2))),128))])]),_(i,{pagination:c.pagination,onChangePage:t.getOrders},null,8,["pagination","onChangePage"])]),_(C,{ref:"orderModal","temp-order":c.tempOrder,onUpdatePaid:t.updatePaid},null,8,["temp-order","onUpdatePaid"]),_(w,{ref:"delModal","temp-item":c.tempOrder,onDeleteItem:t.deleteOrder},null,8,["temp-item","onDeleteItem"])])],64)}const Ie=O(me,[["render",xe]]);export{Ie as default};
